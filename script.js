const auth=firebase.auth();const db=firebase.database();function initAuth(){auth.onAuthStateChanged(user=>{if(user){localStorage.setItem('isLoggedIn','true');document.querySelectorAll('.auth-hide').forEach(el=>el.style.display='none');document.querySelectorAll('.auth-show').forEach(el=>el.style.display='block');checkPremiumAccess();}else{localStorage.removeItem('isLoggedIn');document.querySelectorAll('.auth-hide').forEach(el=>el.style.display='block');document.querySelectorAll('.auth-show').forEach(el=>el.style.display='none');}});}function loginWithGoogle(){const provider=new firebase.auth.GoogleAuthProvider();auth.signInWithPopup(provider).catch(err=>alert('Erro ao logar: '+err.message));}function registerWithEmail(email,password){auth.createUserWithEmailAndPassword(email,password).then(()=>{alert('Conta criada! Fa√ßa login com seu email.');}).catch(err=>alert('Erro: '+err.message));}function logout(){auth.signOut().then(()=>{localStorage.removeItem('isLoggedIn');window.location.href='/';});}function checkPremiumAccess(){const user=firebase.auth().currentUser;if(!user)return;const userRef=db.ref('/users/'+user.uid);userRef.on('value',snapshot=>{const data=snapshot.val();if(!data)return;if(data.hasPremium===true){document.querySelectorAll('.premium-only').forEach(el=>el.style.display='block');document.querySelectorAll('.upgrade-cta').forEach(el=>el.style.display='none');}else{document.querySelectorAll('.premium-only').forEach(el=>el.style.display='none');document.querySelectorAll('.upgrade-cta').forEach(el=>el.style.display='block');}});}function loadProduct(){const urlParams=new URLSearchParams(window.location.search);const productId=urlParams.get('id')||window.location.pathname.split('/').pop();const products={'ebook-ganhar-dinheiro':{name:'üìò eBook: Como Ganhar MZN 50.000/m√™s',desc:'Guia completo com passo a passo, templates e estrat√©gias reais usadas por 2.000+ mo√ßambicanos.',type:'download',url:'/downloads/ebook-ganhar-dinheiro.pdf'},'video-whatsapp-business':{name:'üìπ V√≠deo: WhatsApp Business Pro',desc:'Tutorial completo: como criar cat√°logo, enviar mensagens autom√°ticas e vender sem ser bloqueado.',type:'visit',url:'https://youtube.com/watch?v=exemplo'},'app-moztech-manager':{name:'üì± App: MozTech Manager',desc:'Aplicativo leve para controlar vendas, receitas e contatos ‚Äî instal√°vel no celular.',type:'download',url:'/downloads/app-moztech-manager.apk'}};if(products[productId]){document.getElementById('productName').textContent=products[productId].name;document.getElementById('productDesc').textContent=products[productId].desc;if(products[productId].type==='download'){document.getElementById('downloadLink').href=products[productId].url;document.getElementById('downloadLink').textContent='üì• Baixar '+products[productId].name.replace(/^[^:]+:/,'').trim();}else if(products[productId].type==='visit'){document.getElementById('visitLink').href=products[productId].url;document.getElementById('visitLink').textContent='üåê Visitar '+products[productId].name.replace(/^[^:]+:/,'').trim();}}else{document.getElementById('productName').textContent='Produto n√£o encontrado';document.getElementById('productDesc').textContent='O produto solicitado n√£o existe ou n√£o est√° dispon√≠vel.';}}document.addEventListener('DOMContentLoaded',()=>{initAuth();loadProduct();document.getElementById('sendBtn')?.addEventListener('click',sendMessage);document.getElementById('userInput')?.addEventListener('keypress',e=>{if(e.key==='Enter')sendMessage();});});function sendMessage(){const input=document.getElementById('userInput');if(!input.value.trim())return;const msg=input.value;const newMsg={sender:'user',text:msg,timestamp:Date.now(),responded:false};db.ref('chat/messages').push(newMsg);input.value='';document.getElementById('loading').style.display='block';setTimeout(()=>{const responses=["‚è≥ Aguarde, estamos processando sua solicita√ß√£o... (Resposta em at√© 30 segundos)","‚úÖ Pronto! Aqui est√° a resposta: Para ganhar dinheiro com celular em Mo√ßambique, comece com o nosso Guia PRO. Acesse: https://moztec.vercel.app/pro","‚úÖ Pronto! Aqui est√° a resposta: N√£o precisa de cart√£o internacional. Use M-Pesa + WhatsApp Business. Veja o passo a passo: https://moztec.vercel.app/ganhar-dinheiro","‚úÖ Pronto! Aqui est√° a resposta: Para pagar pelo PRO, clique no bot√£o vermelho na p√°gina principal. √â r√°pido e seguro."];const randomResponse=responses[Math.floor(Math.random()*responses.length)];db.ref('chat/messages').push({sender:'bot',text:randomResponse,timestamp:Date.now(),responded:true});document.getElementById('loading').style.display='none';},15000);}